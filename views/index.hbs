<h1>Slapjack</h1>

<button type="button" id="startGame" onclick="start()" class="btn btn-primary">Start Game</button>
<button type="button" onclick="playCard()" class="btn btn-primary">Play Card</button>
<button type="button" onclick="slap()" class="btn btn-success">Slap!</button>

<img id="card" src="" style="width: 200px; margin-top: 50px">
<div id="messages-container"></div>

<script src="/socket.io/socket.io.js"></script>
<script>
  var socket = io();
  var username = "";
  var id = "";

  socket.on('connect', function() {
    console.log('connected');
  });

  socket.on('username', function(data) {

    if(!data){

      username = prompt("Enter your username!");
      socket.emit('username', username);
    } else{

      id = data;
      $(".username").text(username);
    }



  });

  socket.on('playCard', function(data) {

    var splitDate = data.split(" ");
    var newData = "";
    
    for(var i=0; i<splitDate.length; i++){
      newData += splitDate[i];

      if(i === splitDate.length-1){
        break;
      }

      newData += "_";
    }

    newData += ".svg";

    $('#card').attr("src", `cards/${newData}`);

  });


  socket.on('slap', function(data) {

    // <div id="messages-container"></div>

    console.log(data);

    if(data.winning){
      $('#messages-container').append("<p>You have won!</p>");
    } else{

      $('#messages-container').append(`<p id='fade'>${data.message}</p>`);

      $("#fade").fadeOut("slow");
    }



  });

  socket.on('start', function(data) {


    $('#startGame').prop('disabled', true);

  });

  socket.on('message', function(data) {

    $('#messages-container').append(`<p id='fade'>${data.message}</p>`);

    $("#fade").fadeOut("slow");

  });

  socket.on('disconnect', function() {
    // refresh on disconnect
    window.location = window.location;
  });

  function start() {
    socket.emit('start');
  }

  function playCard() {
    socket.emit('playCard');
  }

  function slap() {
    socket.emit('slap');
  }

</script>
